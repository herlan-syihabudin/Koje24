{"version":3,"sources":["turbopack:///[project]/app/invoice/[id]/page.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState, useEffect } from \"react\";\nimport { useParams } from \"next/navigation\";\nimport QRCode from \"react-qr-code\";\n\ninterface InvoiceData {\n  invoiceId: string;\n  timestamp: string;\n  nama: string;\n  hp: string;\n  alamat: string;\n  produkList: string;\n  qtyTotal: number;\n  subtotalCalc: number;\n  status: string;\n  paymentLabel: string;\n  effectiveOngkir: number;\n  effectiveGrandTotal: number;\n  invoiceUrl: string;\n}\n\nconst formatCurrency = (amount: number): string =>\n  new Intl.NumberFormat(\"id-ID\", {\n    style: \"currency\",\n    currency: \"IDR\",\n    minimumFractionDigits: 0,\n  }).format(amount);\n\n// ðŸ”¥ FIX timestamp format \"30/11/2025, 14.00.54\"\nconst parseTimestamp = (ts: string) => {\n  if (!ts) return null;\n  const [tanggal, waktu] = ts.split(\", \");\n  const [dd, mm, yyyy] = tanggal.split(\"/\");\n  const waktuFix = waktu.replace(/\\./g, \":\");\n  const iso = `${yyyy}-${mm}-${dd}T${waktuFix}`;\n  const d = new Date(iso);\n  return isNaN(d.getTime()) ? null : d;\n};\n\nexport default function InvoicePage() {\n  const params = useParams();\n  const invoiceId = params?.id ? String(params.id) : \"\";\n\n  const [invoice, setInvoice] = useState<InvoiceData | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (!invoiceId) return;\n    let active = true;\n\n    const fetchInvoice = async () => {\n      try {\n        const res = await fetch(`/api/invoice/${invoiceId}`, { cache: \"no-store\" });\n        const result = await res.json();\n\n        if (!active) return;\n\n        if (res.ok && result.success) setInvoice(result.data);\n        else setError(result.message || \"Invoice tidak ditemukan.\");\n      } catch {\n        if (active) setError(\"Terjadi kesalahan koneksi.\");\n      } finally {\n        if (active) setLoading(false);\n      }\n    };\n\n    fetchInvoice();\n    return () => {\n      active = false;\n    };\n  }, [invoiceId]);\n\n  if (loading)\n    return (\n      <div className=\"flex items-center justify-center min-h-screen text-lg\">\n        Memuat Invoice #{invoiceId}...\n      </div>\n    );\n\n  if (error)\n    return (\n      <div className=\"flex items-center justify-center min-h-screen text-lg text-red-600\">\n        {error}\n      </div>\n    );\n\n  if (!invoice)\n    return (\n      <div className=\"flex items-center justify-center min-h-screen text-lg\">\n        Invoice tidak ditemukan.\n      </div>\n    );\n\n  const parsedDate = parseTimestamp(invoice.timestamp);\n  const tanggal = parsedDate\n    ? parsedDate.toLocaleString(\"id-ID\", {\n        year: \"numeric\",\n        month: \"long\",\n        day: \"numeric\",\n        hour: \"2-digit\",\n        minute: \"2-digit\",\n      })\n    : invoice.timestamp;\n\n  const getStatusStyle = (s: string) => {\n    const x = s.toLowerCase();\n    if (x.includes(\"paid\")) return \"bg-green-100 text-green-700 border-green-300\";\n    if (x.includes(\"cod\")) return \"bg-blue-100 text-blue-700 border-blue-300\";\n    if (x.includes(\"pending\") || x.includes(\"belum\"))\n      return \"bg-yellow-100 text-yellow-700 border-yellow-300\";\n    return \"bg-gray-200 text-gray-700 border-gray-300\";\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-100 p-4 sm:p-8 print:p-0\">\n      <style jsx global>{`\n        @media print {\n          body {\n            margin: 0 !important;\n            padding: 0 !important;\n            background: #fff !important;\n          }\n          .invoice-container {\n            box-shadow: none !important;\n            border: none !important;\n            margin: 0 !important;\n            width: 100% !important;\n          }\n          .no-print {\n            display: none !important;\n          }\n        }\n      `}</style>\n\n      <div className=\"invoice-container bg-white max-w-4xl mx-auto rounded-lg shadow-xl p-10 border border-gray-200 relative\">\n        {/* === WATERMARK PAID === */}\n        {invoice.status.toLowerCase().includes(\"paid\") && (\n          <div className=\"absolute inset-0 flex items-center justify-center pointer-events-none select-none\">\n            <span className=\"font-extrabold text-[130px] text-green-600 opacity-15 rotate-[-25deg] tracking-wider\">\n              PAID\n            </span>\n          </div>\n        )}\n\n        {/* === HEADER === */}\n        <div className=\"flex justify-between mb-8 items-start\">\n          <div>\n            <img src=\"/image/logo-koje24.png\" alt=\"KOJE24\" className=\"h-14 w-auto mb-2\" />\n            <p className=\"text-sm text-gray-600 mt-1\">\n              Jl. Kopi Kenangan No. 24, Jakarta Selatan\n              <br />\n              Telp: 0811-2233-4455\n            </p>\n          </div>\n\n          <div className=\"text-right\">\n            <p className=\"text-3xl font-semibold tracking-wide text-[#0B4B50]\">INVOICE</p>\n            <p className=\"text-xl font-bold mt-1\">#{invoice.invoiceId}</p>\n            <p className=\"text-sm mt-1\">Tanggal: {tanggal}</p>\n            <span\n              className={`mt-3 inline-block px-4 py-1 border rounded-full text-sm font-semibold ${getStatusStyle(\n                invoice.status\n              )}`}\n            >\n              {invoice.status.toUpperCase()}\n            </span>\n          </div>\n        </div>\n\n        {/* === BILL TO === */}\n        <div className=\"mb-6\">\n          <h3 className=\"text-sm font-bold text-gray-700 mb-1\">Pembeli</h3>\n          <p className=\"text-gray-800 font-medium\">{invoice.nama}</p>\n          <p className=\"text-gray-600\">{invoice.alamat}</p>\n          <p className=\"text-gray-600\">Telp: {invoice.hp}</p>\n        </div>\n\n        {/* === TABLE === */}\n        <table className=\"w-full text-sm border border-gray-300 mb-6\">\n          <thead>\n            <tr className=\"bg-gray-100\">\n              <th className=\"border border-gray-300 py-2 text-left px-3\">Deskripsi</th>\n              <th className=\"border border-gray-300 py-2 w-24 text-center\">Qty</th>\n              <th className=\"border border-gray-300 py-2 w-40 text-right px-3\">Subtotal</th>\n            </tr>\n          </thead>\n          <tbody>\n            <tr>\n              <td className=\"border border-gray-200 py-2 px-3\">{invoice.produkList}</td>\n              <td className=\"border border-gray-200 text-center\">{invoice.qtyTotal}</td>\n              <td className=\"border border-gray-200 text-right px-3\">\n                {formatCurrency(invoice.subtotalCalc)}\n              </td>\n            </tr>\n          </tbody>\n        </table>\n\n        {/* === TOTAL SECTION === */}\n        <div className=\"flex justify-end mb-8\">\n          <table className=\"text-sm\">\n            <tbody>\n              <tr>\n                <td className=\"py-1 px-4\">Subtotal Produk:</td>\n                <td className=\"text-right font-medium py-1 px-4\">\n                  {formatCurrency(invoice.subtotalCalc)}\n                </td>\n              </tr>\n              <tr>\n                <td className=\"py-1 px-4\">Ongkir:</td>\n                <td className=\"text-right font-medium py-1 px-4\">\n                  {formatCurrency(invoice.effectiveOngkir)}\n                </td>\n              </tr>\n              <tr className=\"text-lg font-bold bg-gray-50\">\n                <td className=\"py-2 px-4\">TOTAL DIBAYARKAN:</td>\n                <td className=\"text-right text-red-600 py-2 px-4\">\n                  {formatCurrency(invoice.effectiveGrandTotal)}\n                </td>\n              </tr>\n            </tbody>\n          </table>\n        </div>\n\n        {/* === QR & BARCODE === */}\n        <div className=\"flex justify-between items-center mt-6 mb-10\">\n          <div className=\"text-sm text-gray-700\">\n            Scan untuk membuka invoice online:\n            <QRCode value={invoice.invoiceUrl} size={90} className=\"mt-2\" />\n          </div>\n          <img\n            src={`https://barcodeapi.org/api/128/${invoice.invoiceId}`}\n            alt=\"barcode\"\n            className=\"h-16\"\n          />\n        </div>\n\n        {/* === FOOTER === */}\n        <p className=\"text-center text-gray-600 text-sm border-t pt-4\">\n          Terima kasih telah berbelanja di <strong>KOJE24</strong> ðŸ’›  \n          Semoga sehat & berenergi setiap hari!\n        </p>\n      </div>\n\n      {/* PRINT / DOWNLOAD PDF */}\n      <div className=\"text-center mt-6 no-print\">\n        <button\n  onClick={() => (window.location.href = `/api/invoice-pdf/${invoice.invoiceId}`)}\n  className=\"px-6 py-2 bg-[#C62828] text-white rounded-full shadow-md hover:bg-[#b12121] transition mt-3 text-sm sm:text-base\"\n>\n  ðŸ“„ Download PDF Resmi (A4)\n</button>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}